# 第四个检查点：员工缴纳地一致性检查 - 需求分析

## 📋 需求理解

### 检查目标
验证员工社保缴纳地与其劳动合同主体所在地是否一致

### 数据源
1. **员工社保信息表** (`employee_social_insurance`)
   - 关键字段：`员工工号`、`姓`、`名`、`开始时间`、`结束时间`、`缴交地`
   
2. **员工合同信息表** (`employee_contracts`)
   - 关键字段：`员工工号`、`姓`、`名`、`开始日期`、`结束日期`、`劳动合同主体所在城市`

### 检查逻辑
1. 获取员工社保信息中的缴纳记录和缴交地
2. 获取员工合同信息中的合同记录和公司所在地
3. 按时间段匹配：检查合同有效期内的社保缴交地是否与合同主体所在城市一致

## 🔍 数据分析结果

### 当前数据状况
- **员工合同信息表**：159 条记录
- **员工社保信息表**：28 条记录
- **地址字段映射**：
  - 社保表：`缴交地` (如："北京")
  - 合同表：`劳动合同主体所在城市` (如："北京市")

### 发现的数据特点
1. **地址格式不统一**：
   - 社保表："北京"
   - 合同表："北京市"
   
2. **时间字段差异**：
   - 社保表：`开始时间`、`结束时间`
   - 合同表：`开始日期`、`结束日期`

## ❓ 关键问题和建议

### 1. 地址标准化问题
**问题**：社保表中的"北京"与合同表中的"北京市"如何匹配？

**建议方案**：
- 创建城市名称标准化函数
- 支持模糊匹配（如："北京" ↔ "北京市"）
- 建立城市别名映射表

### 2. 时间段重叠判断
**问题**：如何准确判断社保缴纳时间与合同有效期的重叠？

**建议方案**：
- 实现时间段重叠算法
- 考虑边界情况（开始/结束日期相等）
- 处理无结束日期的情况（当前有效合同）

### 3. 员工身份匹配
**问题**：如何确保社保记录与合同记录属于同一员工？

**建议方案**：
- 优先使用`员工工号`匹配
- 备用方案：`姓`+`名`组合匹配
- 处理姓名可能分开存储的情况

### 4. 多合同/多社保记录处理
**问题**：一个员工可能有多个合同和多个社保记录，如何处理？

**建议方案**：
- 按时间段分别检查每个社保记录
- 找到时间重叠的合同记录进行比较
- 生成详细的问题报告

### 5. 异常情况处理
**问题**：如何处理以下异常情况？
- 有社保记录但无对应合同记录
- 有合同记录但无对应社保记录
- 时间段完全不重叠

**建议方案**：
- 分类标记不同类型的问题
- 提供详细的问题描述
- 设置不同的风险等级

## 🛠️ 实现方案

### 检查函数设计
```javascript
const checkPaymentLocationConsistency = async () => {
  // 1. 获取所有员工社保数据
  // 2. 获取所有员工合同数据
  // 3. 按员工分组处理
  // 4. 时间段匹配和地址比较
  // 5. 生成问题报告
}
```

### 辅助函数
1. `standardizeCity(cityName)` - 城市名称标准化
2. `isTimeOverlap(period1, period2)` - 时间段重叠判断
3. `findMatchingContracts(socialRecord, contracts)` - 查找匹配的合同

### 结果格式
```javascript
{
  type: 'payment_location_consistency',
  title: '员工缴纳地一致性检查',
  level: 'high|medium|low',
  count: number,
  details: [
    {
      员工工号: string,
      姓名: string,
      问题描述: string,
      社保缴交地: string,
      合同所在地: string,
      社保时间段: string,
      合同时间段: string,
      问题类型: string
    }
  ]
}
```

## 🎯 下一步行动

1. **确认需求细节**：
   - 地址匹配的精确度要求
   - 时间重叠的判断标准
   - 异常情况的处理方式

2. **实现检查功能**：
   - 编写核心检查逻辑
   - 添加到ComplianceChecker组件
   - 创建测试用例

3. **用户界面集成**：
   - 添加第四个检查按钮
   - 设计结果展示界面
   - 测试完整流程